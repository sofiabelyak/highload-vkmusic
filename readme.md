# VK музыка

## 1. Тема и целевая аудитория

VK музыка - российский стриминговый сервис компании VK, объединяющий музыкальную платформу «ВКонтакте» и отдельное приложение для прослушивания музыки.

### Функционал MVP

1. Аутентификация пользователей
2. Поиск и нахождение музыки
3. Прослушивание и воспроизведение музыки
4. Добавление треков в плейлист
5. Создание и редактирование плейлистов
6. История прослушиваний пользователя

### Целевая аудитория

#### Анализ трафика и вовлеченности
* MAU - **42млн** [^1]
* DAU - **5-10млн** [^1]
* Средняя продолжительность сессии - **00:02:17** [^2]
* Среднее количество страниц на посещение - **1,90** [^2]
* Среднее количество новых пользователей в месяц - **1 млн** [^2]

#### Веб-трафик по странам

[![Traffic by Country](img/Traffic_by_Country.jpg)](https://www.similarweb.com/ru/website/music.vk.com) [^2]

#### Демографические показатели

Общая характеристика аудитории (гендер и возраст) [^2]

[![Demographic Indicators](img/Website_Traffic.jpg)](https://www.similarweb.com/ru/website/music.vk.com) 


## 2. Расчет нагрузки

### Продуктовые метрики

| Метрика                  | Значение         | Источник/Формула                              |
|--------------------------|------------------|-----------------------------------------------|
| **MAU**                  | 42M             | [Пресс-релиз VK](RUS_Press_Release_9M_2024.pdf) |
| **DAU**                  | 5-10M           | [Пресс-релиз VK](RUS_Press_Release_9M_2024.pdf) |
| **Хранилище:**           |                  |                                               |
| - Треки/пользователь             | 50              | Spotify-аналоги                               |
| - Метаданные/пользователь        | 0.005 ГБ        | `50 треков × 0.1 МБ`                              |
| **Действия/день:**       |                  |                                               |
| - Поиск                  | 3-5             | Spotify-аналоги                               |
| - Прослушивание          | 10-12 тр        | [Расчет](#audio-calc)                         |
| - Добавление в плейлист  | 1-2             | `1 акт/10 прослушиваний`                      |

---

#### Метаданные {#meta}
- **На 1 трек**: `16B ID + 400B текст = 0.0004 МБ`  
- **С запасом**: `0.1 МБ/трек (обложки/теги)`  
- **Итог**: `50 треков × 0.1 МБ = 0.005 ГБ`

#### Прослушивание треков {#audio-calc}
1. `3-5 сессий × 2:17 мин = 6.8-11.4 мин/день`  
2. `(6.8 мин ÷ 4 мин/трек) + (11.4 ÷ 3) = 1.7-3.8 треков`  
3. **С переключениями треков**: `10-12 трек/день`

## Технические метрики

### Хранилище
| Тип данных              | Единицы      | Объем (ТБ) | Формула расчета                     |
|-------------------------|--------------|------------|--------------------------------------|
| **Аудиофайлы**          | 50 млн треков| 250        | `5 МБ/трек × 50M`                   |
| **Метаданные треков**   | 50 млн запис.| 5          | `0.1 МБ/трек × 50M`                 |
| **Профили пользователей**| 42 млн аккаунтов | 4.2    | `100 КБ/пользователь × 42M`                 |

---

### Сетевые показатели

#### Пиковая нагрузка (Гбит/с)
| Тип трафика       | Значение | Формула                                |
|--------------------|----------|----------------------------------------|
| Аудиопотоки       | 128      | `1M потоков × 128 кбит/с`              |
| API-запросы       | 10       | `10k RPS × 1 КБ/запрос × 8 бит`        |

**Пояснения:**  
- **1M потоков**: 10% от DAU (10M) одновременно слушают музыку.  
- **128 кбит/с**: Битрейт аудио для среднего качества.  
- **10k RPS**: Пиковые запросы к API (поиск, плейлисты, аутентификация).

#### Суточный трафик (ТБ/день)
| Тип трафика       | Значение | Формула                                |
|--------------------|----------|----------------------------------------|
| Аудио             | 300      | `10M DAU × 10 треков × 5 МБ`           |
| API               | 1        | `100M запросов × 10 КБ`                |

---

**Пояснения:**  
- **10 треков/день**: Из продуктовых метрик (прослушивание).  
- **5 МБ/трек**: Средний размер трека (4 минуты при 166 кбит/с).  

### Производительность (RPS)

Средний RPS = Общее кол-во запросов в день / 86,400  
Пиковый RPS = Средний RPS × 10 (коэффициент пиковой нагрузки)

| Метод                     | Средний | Пиковый  | Формула расчета              |
|---------------------------|---------|----------|-------------------------------|
| **Поиск**                | 580     | 5,800    | `50M/86400 × 10`             |
| **Воспроизведение**      | 1,157   | 11,570   | `100M/86400 × 10`            |
| **Добавление в плейлист**| 116     | 1,160    | `10M/86400 × 10`             |
| **Аутентификация**       | 116     | 1,160    | `10M/86400 × 10`             |
| **Управление плейлистами**| 69     | 690      | `6M/86400 × 10`              |
| **Запись истории**       | 1,157   | 11,570   | `100M/86400 × 10`            |

---

**Пояснения:**  
- **Поиск (50M/день)**:  
  `10M DAU × 5 запросов/день` (аналогия с Spotify).  
- **Воспроизведение (100M/день)**:  
  `10M DAU × 10 треков/день` (из продуктовых метрик).  
- **Добавление в плейлист (10M/день)**:  
  `10M DAU × 1 действие/день` (1 сохранение на 10 прослушиваний).  
- **Аутентификация (10M/день)**:  
  Каждый DAU выполняет 1 вход в день.  
- **Управление плейлистами (6M/день)**:  
  `42M MAU / 7 дней` (пользователи редактируют плейлисты в среднем раз в неделю).  
- **Запись истории (100M/день)**:  
  Сохранение каждого прослушивания: `10M DAU × 10 треков`.  

**Примечания:**  
1. **Коэффициент ×10 для пика** — эмпирическое правило: пиковая нагрузка вечером (18:00-22:00) в 10 раз выше средней.
2. **86,400** — количество секунд в сутках (`24 × 60 × 60`).  


## Список источников

[^1]: [Пресс-релиз по рез. 3 кв. и 9 мес. 2024](https://corp.vkcdn.ru/media/files/RUS_Press_Release_9M_2024.pdf)

[^2]: [Анализ веб-трафика music.vk.com](https://www.similarweb.com/ru/website/music.vk.com)
